ml () {  module ml "$@"
}
module () {  local _mlredir=1;
 if [ -n "${MODULES_REDIRECT_OUTPUT+x}" ]; then
 if [ "$MODULES_REDIRECT_OUTPUT" = '0' ]; then
 _mlredir=0;
 else
 if [ "$MODULES_REDIRECT_OUTPUT" = '1' ]; then
 _mlredir=1;
 fi;
 fi;
 fi;
 case " $@ " in 
 *' --no-redirect '*)
 _mlredir=0
 ;;
 *' --redirect '*)
 _mlredir=1
 ;;
 esac;
 if [ $_mlredir -eq 0 ]; then
 _module_raw "$@";
 else
 _module_raw "$@" 2>&1;
 fi
}
_module_raw () {  eval "$(/usr/bin/tclsh8.6 '/usr/lib/x86_64-linux-gnu/modulecmd.tcl' bash "$@")";
 _mlstatus=$?;
 return $_mlstatus
}
#!/bin/bash
#
# testing.sh   Gretchen Kerfoot    Spring 2025
#
#This script tests the querier program by running a series of tests:
#   Tests for one-word queries
#   Tests for implicit and explicit ANDs
#   Tests AND/OR precedence
#   Tests for invalid and empty queries
#   Tests for multiple matches with the same score
#   Tests querier under valgrind for memory leaks

#establishing pageDirectory and indexFile 
PAGEDIR=../../shared/tse/output/crawler/pages-letters-depth-3
INDEXFILE=../../shared/tse/output/indexer/index-letters-3

#one word valid query
echo "Test 1: one-word query"
Test 1: one-word query
echo "Query: search"
Query: search
./querier $PAGEDIR $INDEXFILE <<< "search"
Query: search
score    1 doc   4: http://cs50tse.cs.dartmouth.edu/tse/letters/B.html
score    1 doc   6: http://cs50tse.cs.dartmouth.edu/tse/letters/D.html

#implicit AND valid query
echo "Test 2: implicit AND"
Test 2: implicit AND
echo "Query: computational biology"
Query: computational biology
./querier $PAGEDIR $INDEXFILE <<< "computational biology"
Query: computational biology
score    1 doc   7: http://cs50tse.cs.dartmouth.edu/tse/letters/C.html

#explicit AND valid query
echo "Test 3: explicit AND"
Test 3: explicit AND
echo "Query: computational and biology"
Query: computational and biology
./querier $PAGEDIR $INDEXFILE <<< "computational and biology"
Query: computational and biology
score    1 doc   7: http://cs50tse.cs.dartmouth.edu/tse/letters/C.html

#OR with AND precedence valid query
echo "Test 4: OR with AND precedence"
Test 4: OR with AND precedence
echo "Query: eniac or home and playground"
Query: eniac or home and playground
./querier $PAGEDIR $INDEXFILE <<< "eniac or home and playground"
Query: eniac or home and playground
score    1 doc   1: http://cs50tse.cs.dartmouth.edu/tse/letters/
score    1 doc   3: http://cs50tse.cs.dartmouth.edu/tse/letters/index.html
score    1 doc   5: http://cs50tse.cs.dartmouth.edu/tse/letters/E.html

#invalid characters
echo "Test 5: invalid character"
Test 5: invalid character
echo "Query: hello!"
Query: hello!
./querier $PAGEDIR $INDEXFILE <<< "hello!"
Error: bad character '!' in query.
No documents match.

#leading operator invalid query
echo "Test 6: leading operator"
Test 6: leading operator
echo "Query: and letter"
Query: and letter
./querier $PAGEDIR $INDEXFILE <<< "and letter"
Error: 'and' cannot be first

#trailing operator invalid query
echo "Test 7: trailing operator"
Test 7: trailing operator
echo "Query: letter or"
Query: letter or
./querier $PAGEDIR $INDEXFILE <<< "letter or"
Error: 'or' cannot be last

#adjacent operators invalid query
echo "Test 8: adjacent operators"
Test 8: adjacent operators
echo "Query: letter and or one"
Query: letter and or one
./querier $PAGEDIR $INDEXFILE <<< "letter and or one"
Error: 'and' and 'or' cannot be adjacent

#empty line invalid query
echo "Test 9: empty line"
Test 9: empty line
echo "Query: [empty]"
Query: [empty]
./querier $PAGEDIR $INDEXFILE <<< ""
No documents match.

#multiple matches w same score valid query
echo "Test 10: multiple matches with same score"
Test 10: multiple matches with same score
echo "Query: playground"
Query: playground
./querier $PAGEDIR $INDEXFILE <<< "playground"
Query: playground
score    1 doc   1: http://cs50tse.cs.dartmouth.edu/tse/letters/
score    1 doc   3: http://cs50tse.cs.dartmouth.edu/tse/letters/index.html

#valgrind testing
echo "Valgrind test: memory check on valid queries"
Valgrind test: memory check on valid queries
valgrind --leak-check=full --error-exitcode=1 ./querier $PAGEDIR $INDEXFILE <<EOF
search
computational and biology
eniac or home
EOF
==2560777== Memcheck, a memory error detector
==2560777== Copyright (C) 2002-2022, and GNU GPL'd, by Julian Seward et al.
==2560777== Using Valgrind-3.22.0 and LibVEX; rerun with -h for copyright info
==2560777== Command: ./querier ../../shared/tse/output/crawler/pages-letters-depth-3 ../../shared/tse/output/indexer/index-letters-3
==2560777== 
Query: search
score    1 doc   4: http://cs50tse.cs.dartmouth.edu/tse/letters/B.html
score    1 doc   6: http://cs50tse.cs.dartmouth.edu/tse/letters/D.html
Query: computational and biology
score    1 doc   7: http://cs50tse.cs.dartmouth.edu/tse/letters/C.html
Query: eniac or home
score    2 doc   1: http://cs50tse.cs.dartmouth.edu/tse/letters/
score    2 doc   3: http://cs50tse.cs.dartmouth.edu/tse/letters/index.html
score    2 doc   5: http://cs50tse.cs.dartmouth.edu/tse/letters/E.html
score    1 doc   2: http://cs50tse.cs.dartmouth.edu/tse/letters/A.html
score    1 doc   4: http://cs50tse.cs.dartmouth.edu/tse/letters/B.html
score    1 doc   6: http://cs50tse.cs.dartmouth.edu/tse/letters/D.html
score    1 doc   7: http://cs50tse.cs.dartmouth.edu/tse/letters/C.html
==2560777== 
==2560777== HEAP SUMMARY:
==2560777==     in use at exit: 0 bytes in 0 blocks
==2560777==   total heap usage: 682 allocs, 682 frees, 120,727 bytes allocated
==2560777== 
==2560777== All heap blocks were freed -- no leaks are possible
==2560777== 
==2560777== For lists of detected and suppressed errors, rerun with: -s
==2560777== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

